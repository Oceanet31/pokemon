@startuml

package com{
  package esiea{
    package pootp{
    
      package attacks{
      
        class Attack{
          - String name
          - ElementType type
          - int nbUse
          - int power
          - double failProbability
          
          + Attack(String, ElementType, int, int, double)
          + String getName()
          + ElementType getType()
          + int getNbUse()
          + void setNbUse(int)
          + int getPower()
          + double getFailProbability()
          + void attackUsed()
          + double getAccuracy()
        }
        
      }
      
      package dataBase{
        
        class AttackDataBase{
          - double failProbability
          - int getPower
          - int nbUse
          - String name
          - ElementType type
          - ArrayList<Attack> attacks
          
          + ArrayList<Attack> getAttack()
          + loadAttacksFromFile(File)
          
        }
        
        
        class ItemDataBase{
          - ArrayList<Item> items
          
          + ArrayList<Item> getItems()
          + loadItemsFromFile(File)
        }
        
        class MonsterDataBase{
          - ArrayList<Monster> monsters
          
          - int randomStat(int, int)
          + ArrayList<Monster> getMonsters()
          + loadMonsterFromFile(File)
        }
      }
      
      package game{
        class ActionChoice{
          - int type;
          - Attack attack
          - Item item
          - int switchIndex
        }
        
        class GameEngine{
          - Player player
          - player enemy
          - boolean isWildBattle
          - GameWindow window
          - Runnable onVictory
          
          + GameEngine(Player, Player, boolean, GameWindow)
          + void setOnVictory()
          + void startBattle()
          + void onPlayerAttack(Attack)
          + void onPlayerUseItem(Item)
          + void onPlayerSwitch(int)
          - void processTurn(ActionChoice)
          - void executeAction(Player, ActionChoice, Monster, Monster, Runnable)
          - void checkBattleEndAndContinue(Runnable)
          - void handleKOSwitch(Player, Runnable)
          - void tryCapture(Monster, Runnable)
          - void endTurn()
          - ActionChoice AIChoice()
          - boolean isBattleOver()
          + void updateGraphics()
        }
        
        class Player{
          - String name
          - ArrayList<Monster> team
          - HashMap<Item, Integer> inventory
          
          + Player(String)
          + String getName()
          + ArrayList<Monster> getTeam()
          + HashMap<Item,Integer> getInventory()
          + void addMonsterToTeam(Monster Monster)
          + void addItemToInventory(Item item)
          + void useItem(Item, Monster)
          + boolean hasLost()
          + Monster getActiveMonster()
        }
      }
      
      package gui{
        
        class Animation{
          - List<BufferdImage> frames
          - int currentFrameIndex
          - long lastFrameIndex
          - long frameDelay
          
          + Animation(List<BufferdImage>, int)
          + void update()
          + BufferdImage getSprite()
        }
        
        class BattlePanel{
        
          - Monster playerMonster
          - Monster enemyMonster
          - BufferdImage background
          - BufferdImage podPlayer
          - BufferdImage podEnemy
          - BufferdImage hudPlayerBg
          - BufferdImage hudEnemyBg
          - BufferdImage hpBarAtlas
          - BufferdImage expBarTexture
          - BufferdImage lblPV
          - BufferdImage lblEXP
          - BufferdImage lblLv
          - Animation playerAnimation
          - Animation enemyAnimation
          - Timer gameLoop
          - Font pixelFont
          
          + void updateMonsters(Monster, Monster)
          - Animation loadMonsterAnimation(Monster, boolean)
          # void paintComponent(Graphics)
          - void drawEnemyHUD(Graphics2D, Monster, int, int, int, int)
          - void drawPlayerHUD(Graphics2D, Monster, int, int, int, int)
        }
        
        class AttackInfoPanel{
          - Attack currentAttack
          + void updateInfo(Attack)
          # void paintComponent(Graphics)
          - void drawShadowText(Graphics2D, String, int, int)
        }
        
        class BagOverlay{
          # void paintComponent(Graphics)
        }
        
        class MenuButton{
          - boolean isHovered
          
          + MenuButton(String)
          # paintComponent(Graphics)
        }
        
        class GameWindow{
          - BattlePanel battlePanel
          - JPanel bottomPanel
          - JPanel leftContainer
          - JPanel buttonPanel
          - JTextArea logArea
          - BagOverlay bagOverlay
          - TeamPanel teamOverlay
          - Player player
          - GameEngine gameEngine
          - BufferedImage overlayBg
          - BufferedImage windowFrame
          - BufferedImage cursorImage
          - BufferedImage typeAtlas
          - BufferedImage categoriesAtlas
          - Font pixelFont
          - Timer textTimer
          - String textToDisplay
          - int textIndex
          - Runnable onTextFinished
          - boolean isTyping
          
          + GameWindow(Player)
          + BattlePanel getBattlePanel()
          + void setGameEngine(GameEngine)
          + void showDialogue(String, Runnable)
          - void updateTextTypeWriter()
          + void addLog(String)
          - void initBottomPanel(JPanel)
          + void showMainMenuButtons()
          + void showAttackMenu()
          - MenuButton createMenuButton(String, ActionListener)
          - void toggleBagMenu()
          - void closeBagMenu()
          - void reposBagMenu()
          - void toggleTeamMenu()
          - void closeTeamMenu()
        }
        
        class FrameData{
          - String name
          - BufferedImage img
          + FrameData(String, BufferedImage)
        }
        
        class SpriteManager{
          - {static} Map<String,BufferedImage> cache
          
          + {static} BufferedImage loadImage(String)
          + {static} BufferedImage getPokemonSprite(String, boolean)
          + {static} Animation loadAnimation(String, String)
          + {static} BufferedImage getFrameFromAtlas(String, String, String)
          + {static} BufferedImage getPokemonIcon(String)
        }
        
        class ContextMenu{
          # void paintComponent(Graphics)
        }
        
        class TeamMenuButton{
          - boolean isHovered
          
          + TeamMenuButton(String)
          # void paintComponent(Graphics)
        }
        
        class TeamPanel{
          - Player player
          - Runnable onClose
          - Consumer<Integer> onSwitch
          - int selectedSlot
          - ContextMenu contextMenu
          - Timer animTimer
          - int iconOffsetY
          - int SCALE = 4
          - BufferedImage background
          - BufferedImage hpBarBg
          - BufferedImage lblPv
          - BufferedImage lblLv
          - BufferedImage cursorImage
          - BufferedImage windowFrame
          - Font pixelFont
          - String PATH_TEAM = "com/esiea/pootp/resources/team/"
          - String PATH_UI = "com/esiea/pootp/resources/ui/"
          - String mainSlotJson
          - String mainSlotImg
          - String subSlotJson
          - String subSlotImg
          - String hpJson
          - String hpImg
          
          + TeamPanel(Player, Runnable, Consumer<Integer>)
          - void startAnimation()
          - void stopAnimation()
          - void openContextMenu()
          - void closeContextMenu()
          - void handleSlotClick(int, int)
          # void paintComponent(Graphics)
          - void drawBottomBar(Graphics2D)
          - void drawShadowText(Graphics2D, String, int, int)
          - void drawMainSlot(Graphics2D, Monster, int, int, boolean)
          - void drawSubSlot(Graphics2D, Monster, int, int, boolean)
          - void drawHPBar(Graphics2D, Monster, int, int, boolean)
        }
          
        class UIUtils{
          + {static} void draw9Slice(Graphics2D, BufferedImage, int, int, int, int)
          + {static} Font loadPixelFont(float)
        }
      }
      
      package monsters{
        class BugMonster{
          - int attackCount
          
          + BugMonster(String, int, int, double, int)
          + void attack(Monster, Attack)
          + void getAttacked(Monster, Attack)
        }
        
        class EarthMonster{
          - double fleeingchance
          - int fleeingDuration
          
          + EarthMonster(String, int, int, double, int)
          + double getFleeingChance()
          + void attack(Monster, Attack)
          + void getAttacked(Monster, Attack)
          + boolean isProtected()
        }
        
        class FireMonster{
          - double burningChance
          
          + FireMonster(String, int, int, double, int, double)
          + double getBurningChance()
          + void attack(Monster, Attack)
          + void getAttacked(Monster, Attack)
        }
        
        class LightningMonster{
          - double paralizedChance
          - int paralizedDuration
          
          + LightningMonster(String, int, int, double, int, double)
          + doule getParalizedChance()
          + void attack(Monster, Attack)
          + getAttacked(Monster, Attack)
        }
        
        abstract class Monster{
          - ElementType element
          - String name
          - int hp
          - ArrayList<Attack> attacks
          - int defense
          - double attack
          - int speed
          - State state
          - int round
          - int effectDuration
          - int startingHp
          - String evolutionName
          - int level
          - int xp
          - int xpToNextLevel
          
          + Monster(String, ElementType, int, int, double, int)
          + ElementType getElement()
          + State getState()
          + void setState(State)
          + double ArrayList<Attack> getAttacks()
          + int getEffectDuration()
          + void setEffectDuraion(int)
          + void healFullHp()
          + int getDefense()
          + String getName()
          + int getSpeed()
          + double getAttack()
          + int getLevel()
          + int getXp()
          + int getXpToNextLevel()
          + void setAttack(double)
          + void setSpeed(int)
          + void setDefense(int)
          + int getHp()
          + void setHP(int)
          + int getStartingHp()
          + void setEvolutionName(String)
          + String getEvolutionName()
          + double damages(Monster)
          + double damages(Monster, Attack)
          + void takeDamages(double)
          + void applyStateEffects()
          + void gainXp(int)
          - void levelUp()
          - void learnNewAttack()
          - void increasedStat(double)
          + {abstract} void getAttacked(Monster)
          + {abstract} void attack(Monster)
          
        }
        
        abstract class NatureMonster{
          + NatureMonster(String, int, int, double, int)
          + void recoverHealth(Monster monster)
        }
        
        
        class PlantMonster{
          + PlantMonster(String, int, int, double, int)
          + void attack(Monster, Attack)
          + void getAttacked(Monster, Attack)
        }
        
        class WaterMonster{
          - double floodChance
          - double fallChance
          - int floodDuration
          
          + WaterMonster(String, int, int, double, int, double, double)
          + double getFloodChance()
          + double getFallChance()
          + void attack(Monster, Attack)
          + void getAttacked(Monster, Attack)
          + boolean isTerrainFlooded()
        }
        
        enum ElementType{
          EARTH
          LIGHTNING
          WATER
          FIRE
          NATURE
          NORMAL
        }
        
        enum State{
          NORMAL
          PARALIZED
          POISONED
          BURNED
          FELL
          DEAD
        }
      }
      
      package objects{
        
        abstract class Item{
          + {abstract} void use(Monster)
          + {abstract} String getName()
        }
        
        class Medicament{
          - String name
          - State curedState
          
          + Medicament(String, State)
          + String getName()
          + void use(Monster)
        }
        
        class Pokeball{
          + String getName()
          + void use()
        }
        
        class Potion{
          - String name
          - int power
          - PotionType type
          
          + Potion(String, int, PotionType)
          + String getName()
          + int getPower()
          + PotionType getType()
          + void use(Monster)
        }
        
        enum PotionType{
          HEAL
          REVIVE
          CURE
          BOOST_ATTACK
          BOOST_DEFENSE
          BOOST_SPEED
        }
      }
      
      class PokemonApp{
        - {static} MonsterDataBase monsterDB
        + {static} AttackDataBase attackDB
        - {static} ItemDataBase itemDB
        
        + {static} void main(String[])
        + {static} void startNextBattle(Player, GameWindow, int)
        + {static} Monster createRandomMonster()
        + {static} void assignRandomAttacks(Monster)
        + {static} Monster cloneMonster(Monster)
      }
    }
  }
}


JPanel 	<|-- BattlePanel
JPanel 	<|-- AttackInfoPanel
JPanel 	<|-- BagOverlay
JPanel 	<|-- TeamPanel
JPanel 	<|-- ContextMenu

JFrame 	<|-- GameWindow

JButton <|-- MenuButton
JButton <|-- TeamMenuButton

Monster <|-- FireMonster
Monster <|-- EarthMonster
Monster <|-- LightningMonster
Monster <|-- WaterMonster
Monster <|-- NatureMonster

NatureMonster <|-- PlantMonster
NatureMonster <|-- BugMonster

Item 	<|-- Medicament
Item 	<|-- Pokeball
Item 	<|-- Potion



Attack <-- ElementType

AttackDataBase <-- ElementType
AttackDataBase "0..1" <-- "0..*" Attack

ItemDataBase "0..1" <-- "0..*" Item

MonsterDataBase "0..1" <-- "0..*" Monster

GameEngine <-- "2" Player
GameEngine <-- GameWindow
GameEngine <-- Runnable

ActionChoice <-- Attack
ActionChoice <-- Item

Player "1" <-- "1..4" Monster
Player "1" <-- "0..*" Item

Animation <-- "0..*" BufferedImage

BattlePanel <-- "2" Monster
BattlePanel <-- "10" BufferedImage
BattlePanel <-- "2" Animation
BattlePanel <-- Timer
BattlePanel <-- Font

GameWindow <-- BattlePanel
GameWindow <-- "3" JPanel
GameWindow <-- JTextArea
GameWindow <-- BagOverlay
GameWindow <-- TeamPanel
GameWindow <-- Player
GameWindow <-- GameEngine
GameWindow <-- "5" BufferedImage
GameWindow <-- Font
GameWindow <-- Timer
GameWindow <-- Runnable

AttackInfoPanel <-- Attack

SpriteManager <--"0..*" BufferedImage

FrameData <-- BufferedImage

TeamPanel <-- Player
TeamPanel <-- Runnable
TeamPanel <-- ContextMenu
TeamPanel <-- Timer
TeamPanel <-- "6" BufferedImage
TeamPanel <-- Font

Monster <-- ElementType
Monster <-- "4" Attack

Medicament <-- State
Potion <-- PotionType

PokemonApp <-- MonsterDataBase
PokemonApp <-- AttackDataBase
PokemonApp <-- ItemDataBase

@enduml